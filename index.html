<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
  <title>Softdebut Line OA</title>
  <link rel="stylesheet" href="css/style.css" media="all">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css" />
</head>

<body>
  <div id="sence1">
    <div class="header">
      <button id="btnClose" onclick="closed()"><i class="fa-solid fa-chevron-left"></i> </button>
      <h1 class="font-title">แจ้งปัญหาการใช้งาน</h1>
      <p>เพื่อให้การตรวจสอบและแก้ไขปัญหาดำเนินไปได้อย่างรวดเร็ว กรุณากรอกข้อมูลให้ถูกต้องชัดเจน
        หรือแนบรูปภาพระหว่างมีปัญหาเข้ามา</p>
    </div>
    <div class="box-shadow"></div>
    <div class="content">



      <div class="form-group">
        <div class="form-label-block">
          <label class="form-label">รหัสประจำโครงการ<span class="required">*</span></label>
        </div>
        <div class="form-control-block">
          <input type="text" id="input_proj" class="form-control" oninput="checkempty(this,'step1')" />
          <span id="lbl-error" class="lbl-error">ไม่พบรหัสโครงการ</span>
        </div>
        <div class="hr" id="hrline1"></div>
        <button type="button" id="btn_search_proj" class="btn btn-main btn-green" onclick="searchproj(this)"
          disabled="true">ค้นหา</button>
      </div>

      <div class="form-group" id="ticket_info">

        <div class="form-label-block">
          <label class="form-label">รายละเอียด</label>
        </div>
        <div class="form-control-block">
          <textarea id="ticket_text" class="form-control" oninput="checkempty(this,'step2')"> </textarea>
        </div>



        <div class="upload-img-block">
          <div class="upload-img-block-input">
            <button type="button" id="btn_upload_img"
              class="btn btn-main btn-blue btn-upload-images">เลือกรูปภาพ</button>
            <input type="file" name="upimgGallery" id="upimgGallery" class="imgstore" accept=".png,.jpg,.jpeg"
              onchange="uploadimg(this,'ticketimg');" onclick="this.value=null;">
          </div>
        </div>
        <div class="font-small info">
          <p>&#8226; สามารถแนบไฟล์ได้สูงสุด 5 ไฟล์ (สกุลไฟล์ที่รองรับ : JPEG, GIF, PNG, BMP, PDF)</p>
          <p>&#8226; ขนาดไฟล์ที่แนบได้สูงสุดคือ 10 MB ต่อ 1 ไฟล์</p>
        </div>
        <div id="ticketimg"></div>
        <div class="hr" id="hrline2"></div>
        <button type="button" id="btn_send_ticket" class="btn btn-main btn-green" onclick="sendticket()"
          disabled="true">ส่ง</button>

      </div>



      <!--Loading-->
      <div id="loading" class="loadingio-spinner-bars-ji6zqk06ekj">
        <div class="ldio-ut6coayxxza">
          <div></div>
          <div></div>
          <div></div>
          <div></div>
        </div>
      </div>



    </div>
  </div>

  <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
  <script src="js/vconsole.min.js"></script>
  <script>
    var vConsole = new VConsole()
    console.log("Hello World!")
  </script>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    function createUniversalLink() {
    }

    async function shareMsg() {
      await liff.shareTargetPicker([
        {
          "type": "text",
          "text": "This message was sent by sharetargetpicker"
        }
      ])
    }


    async function closed() {
      await liff.closeWindow()
    }

    function searchproj(e) {
      showloading()
      var inputval = document.getElementById("input_proj").value
      //alert(inputval)
      if(inputval == "T009"){
        document.getElementById("input_proj").value = "NT Online Payment"
        document.getElementById("btn_search_proj").style.display = "none"
        document.getElementById("hrline1").style.display = "none"
        document.getElementById("lbl-error").style.display = "none"
        document.getElementById("input_proj").disabled = true
        document.getElementById("ticket_info").style.display = "block"
        
      }else{
        document.getElementById("lbl-error").style.display = "block"
        document.getElementById("btn_search_proj").style.display = "block"
        document.getElementById("hrline1").style.display = "block"
      }
      
    }


    function showloading() {
      document.getElementById("loading").style.display = "block"
      setTimeout(hideloading, 2000);
    }
    function hideloading() {
      document.getElementById("loading").style.display = "none"
    }

    function uploadimg(input, type) {

      let nametype = "#" + type;
      let ids = input.ids;
      var total_file = input.files.length;

      for (var i = 0; i < total_file; i++) {
        var fsize = (input.files[0].size);
        var fname = (input.files[0].name);

        if (fsize > 10000000) {

          alert('ขนาดรูปไม่เกิน 10 MB');
          input.val("");
        }
        else {
          var maxfile = document.getElementById("ticketimg").childElementCount;
          if (maxfile < 5) {
            document.getElementById("ticketimg").innerHTML += "<div class='ticketimg_item'><i class='fa-solid fa-file-lines'></i><span class='img-file-name'>" + fname + "</span><img src='" + URL.createObjectURL(event.target.files[i]) + "'   class='img-ticket-item' style='display:none'><br>(" + fsize / 1000 + "KB)<i class='fa-solid fa-circle-xmark' onclick='removeimg(this)'></i></div>"
          } else {
            alert("สามารถแนบไฟล์ได้สูงสุด 5 ไฟล์")
          }

        }
      }
    }
    function removeimg(e) {
      e.parentNode.remove();
    }

    function checkempty(e, step) {

      let stepname = step;
      var inputval = e.value;
      if (stepname == "step1") {
        if (inputval == "" || inputval == null) {
          document.getElementById("btn_search_proj").disabled = true
        } else {
          document.getElementById("btn_search_proj").disabled = false
        }
      } else {

        if (inputval == "" || inputval == null) {
          document.getElementById("btn_send_ticket").disabled = true
        } else {
          document.getElementById("btn_send_ticket").disabled = false
        }
      }



    }
    function sendticket(e) {
      showloading()
      setTimeout(closed, 4000);

    }


    async function sendMsg() {

      if (liff.getContext().type !== "none") {
        await liff.sendMessages([
          {
            "type": "sticker",
            "stickerId": 1,
            "packageId": 1
          }
        ])

      } else {
        alert("Message Unsent");
      }
    }


    async function main() {
      await liff.init({ liffId: "1657259345-yeKq1q6V" })
      /*document.getElementById("isLoggedIn").append(liff.isLoggedIn())
      if(liff.isLoggedIn()){
       getEnvironment()
       getUserProfile()
       getContext()
      }else{
        liff.login()
      }*/

    }
    main()
  </script>
</body>

</html>
